<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é£˜é›ªåœ£è¯æ ‘ä¸‹çš„éŸ³ä¹æ´¾å¯¹</title>
<style>
  body {
    margin: 0;
    padding: 0;
    width: 100vw;
    height: 100vh;
    background: #001;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: monospace;
    overflow: hidden;
    color: white;
    position: relative;
  }
  #tree-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 1;
  }
  .tree-level {
    display: flex;
    justify-content: center;
  }
  .snow {
    color: #97EEEE;
    position: absolute;
    font-size: 14px;
    opacity: 0.8;
    pointer-events: none;
    animation: snowfall linear infinite;
    top: -20px;
  }
  @keyframes snowfall {
    0% {
      transform: translateX(0);
      opacity: 0.9;
    }
    50% {
      transform: translateX(calc(Math.random() * 40px - 20px));
      opacity: 0.8;
    }
    100% {
      transform: translateX(calc(Math.random() * 60px - 30px));
      top: 100vh;
      opacity: 0;
    }
  }
  .star {
    color: #FFD700;
    text-shadow: 0 0 15px #FFD700;
    font-size: 20px;
  }
  .light-red {
    color: #FF4136;
    text-shadow: 0 0 10px #FF4136;
  }
  .light-green {
    color: #2ECC40;
    text-shadow: 0 0 10px #2ECC40;
  }
  .light-yellow {
    color: #FFDC00;
    text-shadow: 0 0 10px #FFDC00;
  }
  .light-purple {
    color: #B10DC9;
    text-shadow: 0 0 10px #B10DC9;
  }
  .tree-green {
    color: #00FF00;
    text-shadow: 0 0 8px #00FF00;
  }
  .trunk {
    color: #D4A017;
    text-shadow: 0 0 8px #D4A017;
  }
  /* éŸ³ä¹æ§åˆ¶åŒºæ ·å¼ */
  #music-control {
    position: absolute;
    top: 20px;
    right: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    z-index: 2;
  }
  #music-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #FFD700;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 0 10px #FFD700;
  }
  #volume-slider {
    width: 80px;
    background: #333;
    height: 6px;
    border-radius: 3px;
    outline: none;
  }
  #volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: #FFD700;
    cursor: pointer;
    box-shadow: 0 0 5px #FFD700;
  }
  /* ä¸Šä¼ éŸ³ä¹æŒ‰é’® */
  #upload-btn {
    background: #333;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    border: 1px solid #FFD700;
  }
  #upload-btn:hover {
    background: #555;
  }
  #file-input {
    display: none;
  }
  /* æç¤ºæ–‡å­— */
  #tips {
    position: absolute;
    bottom: 20px;
    text-align: center;
    font-size: 14px;
    opacity: 0.8;
    text-shadow: 0 0 5px #fff;
  }
</style>
</head>
<body>
<div id="tree-container"></div>
<div id="snow-container"></div>
<!-- éŸ³ä¹æ§åˆ¶åŒº -->
<div id="music-control">
  <div id="music-btn">ğŸµ</div>
  <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.7">
  <label for="file-input" id="upload-btn">é€‰æ‹©æœ¬åœ°åœ£è¯éŸ³ä¹</label>
  <input type="file" id="file-input" accept="audio/*">
</div>
<!-- æç¤ºæ–‡å­— -->
<div id="tips">
  æ­¥éª¤ï¼š1. ç‚¹å‡»ã€Œé€‰æ‹©æœ¬åœ°åœ£è¯éŸ³ä¹ã€ä¸Šä¼ éŸ³ä¹æ–‡ä»¶ 2. ç‚¹å‡»éŸ³ä¹æŒ‰é’®æ’­æ”¾
</div>

<audio id="christmas-music" loop>
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾


<script>
  // å‚æ•°é…ç½®
  const HEIGHT = 14;
  const WIDTH = 2 * HEIGHT + 9;
  const SPEED = 150;
  const LIGHTS = ["light-red", "light-green", "light-yellow", "light-purple"];
  const GREEN = "tree-green";
  const SNOW = "snow";
  const STAR = "star";
  const SNOW_DENSITY = 1.2;
  const SNOW_MAX_COUNT = 150;
  const SNOW_SPEED_RANGE = [1.5, 4];

  const treeContainer = document.getElementById('tree-container');
  const snowContainer = document.getElementById('snow-container');
  const music = document.getElementById('christmas-music');
  const musicBtn = document.getElementById('music-btn');
  const volumeSlider = document.getElementById('volume-slider');
  const uploadBtn = document.getElementById('upload-btn');
  const fileInput = document.getElementById('file-input');
  const tips = document.getElementById('tips');
  let isPlaying = false;
  let hasUploaded = false;

  // éŸ³é‡è°ƒèŠ‚
  volumeSlider.addEventListener('input', () => {
    music.volume = volumeSlider.value;
  });

  // é€‰æ‹©æœ¬åœ°éŸ³ä¹æ–‡ä»¶
  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      const fileURL = URL.createObjectURL(file);
      music.src = fileURL;
      hasUploaded = true;
      tips.textContent = "éŸ³ä¹å·²ä¸Šä¼ ï¼ç‚¹å‡»éŸ³ä¹æŒ‰é’®å¼€å§‹æ’­æ”¾ï½";
    }
  });

  // æ’­æ”¾/æš‚åœæ§åˆ¶
  musicBtn.addEventListener('click', () => {
    if (!hasUploaded) {
      tips.textContent = "å…ˆä¸Šä¼ æœ¬åœ°éŸ³ä¹æ–‡ä»¶å†æ’­æ”¾å“¦ï½";
      return;
    }

    if (isPlaying) {
      music.pause();
      musicBtn.textContent = "ğŸµ";
    } else {
      music.play().then(() => {
        isPlaying = true;
        musicBtn.textContent = "â¸";
        tips.textContent = "åœ£è¯å¿«ä¹å‘€ï½ ç‚¹å‡»æŒ‰é’®å¯ä»¥æš‚åœ/æ’­æ”¾";
      }).catch(err => {
        tips.textContent = "ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®å†è¯•ä¸€æ¬¡ï½";
        // ç‚¹å‡»é¡µé¢è§¦å‘æ’­æ”¾
        document.body.addEventListener('click', () => {
          music.play();
          isPlaying = true;
          musicBtn.textContent = "â¸";
          tips.textContent = "åœ£è¯å¿«ä¹å‘€ï½ ç‚¹å‡»æŒ‰é’®å¯ä»¥æš‚åœ/æ’­æ”¾";
        }, { once: true });
      });
    }
    isPlaying = !isPlaying;
  });

  function clearTree() {
    treeContainer.innerHTML = '';
  }

  function createSnowflake() {
    if (snowContainer.children.length >= SNOW_MAX_COUNT) return;

    const snowflake = document.createElement('span');
    snowflake.className = SNOW;
    snowflake.textContent = Math.random() > 0.5 ? "â„" : "â…";
    
    snowflake.style.left = `${Math.random() * 100}vw`;
    const size = Math.random() * 10 + 8;
    snowflake.style.fontSize = `${size}px`;
    const duration = Math.random() * (SNOW_SPEED_RANGE[1] - SNOW_SPEED_RANGE[0]) + SNOW_SPEED_RANGE[0];
    snowflake.style.animationDuration = `${duration}s`;
    snowflake.style.opacity = Math.random() * 0.6 + 0.4;

    snowContainer.appendChild(snowflake);

    setTimeout(() => {
      snowflake.remove();
    }, duration * 1000 + 1000);
  }

  function drawTree() {
    clearTree();
    let canvas = Array(HEIGHT + 6).fill(null).map(() => Array(WIDTH).fill(" "));

    canvas[1][Math.floor(WIDTH / 2)] = `<span class="${STAR}">â˜…</span>`;

    for (let i = 0; i < HEIGHT; i++) {
      for (let j = 0; j < 2 * i + 1; j++) {
        let x = Math.floor(WIDTH / 2) - i + j;
        let y = i + 2;
        if (Math.random() < 0.3) {
          canvas[y][x] = `<span class="${LIGHTS[Math.floor(Math.random() * LIGHTS.length)]}">â—</span>`;
        } else {
          canvas[y][x] = `<span class="${GREEN}">*</span>`;
        }
      }
    }

    for (let i = 0; i < 3; i++) {
      canvas[HEIGHT + 2 + i][Math.floor(WIDTH / 2)] = `<span class="trunk">|</span>`;
    }

    canvas.forEach(row => {
      const treeLevel = document.createElement('div');
      treeLevel.className = 'tree-level';
      row.forEach(cell => {
        const span = document.createElement('span');
        span.innerHTML = cell;
        treeLevel.appendChild(span);
      });
      treeContainer.appendChild(treeLevel);
    });

    const merryChristmas = document.createElement('div');
    merryChristmas.innerHTML = "ğŸ„ğŸ… ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤! ğŸ";
    merryChristmas.style.marginTop = "10px";
    merryChristmas.style.textShadow = "0 0 10px #FFD700";
    merryChristmas.style.fontSize = "16px";
    treeContainer.appendChild(merryChristmas);
  }

  function mainLoop() {
    for (let i = 0; i < Math.ceil(SNOW_DENSITY); i++) {
      createSnowflake();
    }
    drawTree();
    setTimeout(mainLoop, SPEED);
  }

  mainLoop();
</script>
</body>
</html>