<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åœ£è¯æ ‘</title>
<style>
  body {
    margin: 0;
    padding: 0;
    width: 100vw;
    height: 100vh;
    background: #001;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: monospace;
    overflow: hidden;
    color: white;
    position: relative;
  }
  #tree-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 1;
  }
  .tree-level { display: flex; justify-content: center; }
  .snow {
    color: #97EEEE;
    position: absolute;
    font-size: 14px;
    opacity: 0.8;
    pointer-events: none;
    animation: snowfall linear infinite;
    top: -20px;
  }
  @keyframes snowfall {
    0% { transform: translateX(0); opacity: 0.9; }
    50% { transform: translateX(calc(var(--rand-x,0) * 1px)); opacity: 0.8; }
    100% { transform: translateX(calc(var(--rand-x,0) * 1px)); top: 100vh; opacity: 0; }
  }
  .star { color: #FFD700; text-shadow: 0 0 15px #FFD700; font-size: 20px; }
  .light-red { color: #FF4136; text-shadow: 0 0 10px #FF4136; }
  .light-green { color: #2ECC40; text-shadow: 0 0 10px #2ECC40; }
  .light-yellow { color: #FFDC00; text-shadow: 0 0 10px #FFDC00; }
  .light-purple { color: #B10DC9; text-shadow: 0 0 10px #B10DC9; }
  .tree-green { color: #00FF00; text-shadow: 0 0 8px #00FF00; }
  .trunk { color: #D4A017; text-shadow: 0 0 8px #D4A017; }
  #tips { position:absolute; bottom:10px; font-size:14px; opacity:0.8; text-shadow:0 0 5px #fff; }
</style>
</head>
<body>
<div id="tree-container"></div>
<div id="snow-container"></div>
<div id="tips">ç‚¹å‡»é¡µé¢å¼€å§‹éŸ³ä¹ ğŸµ</div>

<!-- è‡ªåŠ¨æ’­æ”¾éŸ³ä¹ -->
<audio id="christmas-music" src="1.mp3" loop></audio>

<script>
  const HEIGHT = 14;
  const WIDTH = 2 * HEIGHT + 9;
  const SPEED = 150;
  const LIGHTS = ["light-red","light-green","light-yellow","light-purple"];
  const GREEN = "tree-green";
  const SNOW = "snow";
  const STAR = "star";
  const SNOW_DENSITY = 1.2;
  const SNOW_MAX_COUNT = 150;
  const SNOW_SPEED_RANGE = [1.5,4];

  const treeContainer = document.getElementById('tree-container');
  const snowContainer = document.getElementById('snow-container');
  const music = document.getElementById('christmas-music');
  const tips = document.getElementById('tips');

  let isPlaying = false;

  function createSnowflake() {
    if (snowContainer.children.length >= SNOW_MAX_COUNT) return;
    const snowflake = document.createElement('span');
    snowflake.className = SNOW;
    snowflake.textContent = Math.random() > 0.5 ? "â„" : "â…";
    const randX = Math.random()*60-30;
    snowflake.style.left = `${Math.random()*100}vw`;
    snowflake.style.setProperty('--rand-x', randX);
    const size = Math.random()*10+8;
    snowflake.style.fontSize = `${size}px`;
    const duration = Math.random()*(SNOW_SPEED_RANGE[1]-SNOW_SPEED_RANGE[0])+SNOW_SPEED_RANGE[0];
    snowflake.style.animationDuration = `${duration}s`;
    snowflake.style.opacity = Math.random()*0.6+0.4;
    snowContainer.appendChild(snowflake);
    setTimeout(()=>snowflake.remove(), duration*1000+1000);
  }

  function clearTree() { treeContainer.innerHTML=''; }

  function drawTree() {
    clearTree();
    let canvasArr = Array(HEIGHT+6).fill(null).map(()=>Array(WIDTH).fill(" "));
    canvasArr[1][Math.floor(WIDTH/2)] = `<span class="${STAR}">â˜…</span>`;
    for(let i=0;i<HEIGHT;i++){
      for(let j=0;j<2*i+1;j++){
        let x=Math.floor(WIDTH/2)-i+j;
        let y=i+2;
        if(Math.random()<0.3){
          canvasArr[y][x]=`<span class="${LIGHTS[Math.floor(Math.random()*LIGHTS.length)]}">â—</span>`;
        } else {
          canvasArr[y][x]=`<span class="${GREEN}">*</span>`;
        }
      }
    }
    for(let i=0;i<3;i++){
      canvasArr[HEIGHT+2+i][Math.floor(WIDTH/2)] = `<span class="trunk">|</span>`;
    }
    canvasArr.forEach(row=>{
      const treeLevel=document.createElement('div');
      treeLevel.className='tree-level';
      row.forEach(cell=>{
        const span=document.createElement('span');
        span.innerHTML=cell;
        treeLevel.appendChild(span);
      });
      treeContainer.appendChild(treeLevel);
    });
    const merryChristmas=document.createElement('div');
    merryChristmas.innerHTML="ğŸ„ğŸ… ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤! ğŸ";
    merryChristmas.style.marginTop="10px";
    merryChristmas.style.textShadow="0 0 10px #FFD700";
    merryChristmas.style.fontSize="16px";
    treeContainer.appendChild(merryChristmas);
  }

  function mainLoop() {
    for(let i=0;i<Math.ceil(SNOW_DENSITY);i++) createSnowflake();
    drawTree();
    setTimeout(mainLoop, SPEED);
  }

  mainLoop();

  // ===== ç‚¹å‡»æ’­æ”¾éŸ³ä¹ =====
  document.body.addEventListener('click', ()=>{
    if(!isPlaying){
      music.play().then(()=>{
        isPlaying = true;
        tips.textContent="ğŸµ éŸ³ä¹æ’­æ”¾ä¸­ ğŸµ";
      }).catch(()=>{
        tips.textContent="è¯·å†æ¬¡ç‚¹å‡»é¡µé¢ä»¥å…è®¸æ’­æ”¾éŸ³ä¹ ğŸµ";
      });
    }
  }, { once: true });
</script>
</body>
</html>
